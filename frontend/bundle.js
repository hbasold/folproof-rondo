(()=>{var At=Object.create;var Je=Object.defineProperty;var Ct=Object.getOwnPropertyDescriptor;var qt=Object.getOwnPropertyNames;var Bt=Object.getPrototypeOf,Rt=Object.prototype.hasOwnProperty;var be=(e=>typeof require<"u"?require:typeof Proxy<"u"?new Proxy(e,{get:(t,i)=>(typeof require<"u"?require:t)[i]}):e)(function(e){if(typeof require<"u")return require.apply(this,arguments);throw Error('Dynamic require of "'+e+'" is not supported')});var Ze=(e,t)=>()=>(t||e((t={exports:{}}).exports,t),t.exports);var Nt=(e,t,i,n)=>{if(t&&typeof t=="object"||typeof t=="function")for(let r of qt(t))!Rt.call(e,r)&&r!==i&&Je(e,r,{get:()=>t[r],enumerable:!(n=Ct(t,r))||n.enumerable});return e};var Ke=(e,t,i)=>(i=e!=null?At(Bt(e)):{},Nt(t||!e||!e.__esModule?Je(i,"default",{value:e,enumerable:!0}):i,e));var $e=Ze(q=>{var ne=ne||{};(function(){"use strict";var e=ne.platform==="win32";function t(r,s){for(var o=0,a=r.length;a>=0;a--){var u=r[a];u=="."?r.splice(a,1):u===".."?(r.splice(a,1),o++):o&&(r.splice(a,1),o--)}if(s)for(;o--;o)r.unshift("..");return r}if(e){var i=/^(.+(?:[\\\/](?!$)|:)|[\\\/])?((?:.+?)?(\.[^.]*)?)$/,n=/^([a-zA-Z]:|[\\\/]{2}[^\\\/]+[\\\/][^\\\/]+)?([\\\/])?(.*?)$/;q.resolve=function(){for(var r="",s="",o=!1,a=arguments.length;a>=-1;a--){var u=a>=0?arguments[a]:ne.cwd();if(!(typeof u!="string"||!u)){var c=n.exec(u),m=c[1]||"",_=m&&m.charAt(1)!==":",b=!!c[2]||_,S=c[3];if(!(m&&r&&m.toLowerCase()!==r.toLowerCase())&&(r||(r=m),o||(s=S+"\\"+s,o=b),r&&o))break}}if(!o&&r){var j="";s=j+"\\"+s,o=!0}r=r.replace(/\//g,"\\");function I(Y){return!!Y}return s=t(s.split(/[\\\/]+/).filter(I),!o).join("\\"),r+(o?"\\":"")+s||"."},q.normalize=function(r){var s=n.exec(r),o=s[1]||"",a=o&&o.charAt(1)!==":",u=!!s[2]||a,c=s[3],m=/[\\\/]$/.test(c);return c=t(c.split(/[\\\/]+/).filter(function(_){return!!_}),!u).join("\\"),!c&&!u&&(c="."),c&&m&&(c+="\\"),o+(u?"\\":"")+c},q.join=function(){function r(a){return a&&typeof a=="string"}var s=Array.prototype.slice.call(arguments,0).filter(r),o=s.join("\\");return/^[\\\/]{2}/.test(o)&&!/^[\\\/]{2}/.test(s[0])&&(o=o.slice(1)),q.normalize(o)}}else{var i=/^(.+\/(?!$)|\/)?((?:.+?)?(\.[^.]*)?)$/;q.resolve=function(){for(var s="",o=!1,a=arguments.length;a>=-1&&!o;a--){var u=a>=0?arguments[a]:ne.cwd();typeof u!="string"||!u||(s=u+"/"+s,o=u.charAt(0)==="/")}return s=t(s.split("/").filter(function(c){return!!c}),!o).join("/"),(o?"/":"")+s||"."},q.normalize=function(s){var o=s.charAt(0)==="/",a=s.slice(-1)==="/";return s=t(s.split("/").filter(function(u){return!!u}),!o).join("/"),!s&&!o&&(s="."),s&&a&&(s+="/"),(o?"/":"")+s},q.join=function(){var s=Array.prototype.slice.call(arguments,0);return q.normalize(s.filter(function(o,a){return o&&typeof o=="string"}).join("/"))}}q.dirname=function(r){var s=i.exec(r)[1]||"";return s?s.length===1||e&&s.length<=3&&s.charAt(1)===":"?s:s.substring(0,s.length-1):"."},q.basename=function(r,s){var o=i.exec(r)[2]||"";return s&&o.substr(-1*s.length)===s&&(o=o.substr(0,o.length-s.length)),o},q.extname=function(r){return i.exec(r)[3]||""},q.exists=function(r,s){ne.binding("fs").stat(r,function(o,a){s&&s(!o)})},q.existsSync=function(r){try{return ne.binding("fs").stat(r),!0}catch{return!1}}})()});var je=Ze((Z,Te)=>{var Ee=function(){var e=function(z,V,f,p){for(f=f||{},p=z.length;p--;f[z[p]]=V);return f},t=[2,4],i=[1,7],n=[1,4],r=[1,18],s=[1,8],o=[1,9],a=[1,13],u=[1,16],c=[1,17],m=[6,8,12],_=[8,12],b=[6,8,12,35,38],S=[6,8,12,23,24,35,38],j=[6,8,12,23,24,26,35,38],I=[6,8,12,23,24,26,28,35,38],Y=[6,8,12,23,24,26,28,32,35,37,38],L=[2,28],ee={trace:function(){},yy:{},symbols_:{error:2,proof:3,clause_list:4,proof_option0:5,ENDOFFILE:6,box:7,EOL:8,BOX:9,with:10,box_option0:11,DEBOX:12,box_option1:13,sentence:14,box_option2:15,WITH:16,ID:17,e_top:18,EXISTS:19,DOT:20,FORALL:21,e_or:22,IFF:23,IMPLIES:24,e_and:25,OR:26,e_not:27,AND:28,NOT:29,atom:30,term:31,EQUALS:32,BOTTOM:33,LPAREN:34,RPAREN:35,term_list:36,COMMA:37,JUSTIFICATION:38,$accept:0,$end:1},terminals_:{2:"error",6:"ENDOFFILE",8:"EOL",9:"BOX",12:"DEBOX",16:"WITH",17:"ID",19:"EXISTS",20:"DOT",21:"FORALL",23:"IFF",24:"IMPLIES",26:"OR",28:"AND",29:"NOT",32:"EQUALS",33:"BOTTOM",34:"LPAREN",35:"RPAREN",37:"COMMA",38:"JUSTIFICATION"},productions_:[0,[3,3],[4,1],[4,3],[4,0],[7,6],[7,4],[7,2],[10,2],[14,1],[14,1],[18,4],[18,4],[18,3],[18,3],[18,1],[22,3],[22,1],[25,3],[25,1],[27,2],[27,1],[30,3],[30,1],[30,1],[30,3],[36,1],[36,3],[36,0],[31,4],[31,1],[5,0],[5,1],[11,0],[11,1],[13,0],[13,1],[15,0],[15,1]],performAction:function(V,f,p,g,x,l,A){var h=l.length-1;switch(x){case 1:return this.$=l[h-2],this.$;break;case 2:case 26:this.$=[l[h]];break;case 3:this.$=l[h-2],this.$.push(l[h]);break;case 4:case 28:this.$=[];break;case 5:this.$=["folbox",l[h-2],l[h-4],this._$],l[h-2]&&l[h-2][0]&&l[h-2][0][0]=="rule"&&l[h-2][0][2].auto&&(l[h-2][0][2]=["assumption",null]);break;case 6:this.$=["box",l[h-2],this._$],l[h-2]&&l[h-2][0]&&l[h-2][0][0]=="rule"&&l[h-2][0][2].auto&&(l[h-2][0][2]=["assumption",null]);break;case 7:this.$=l[h-1][0]!="error"?["rule",l[h-1],l[h],this._$]:l[h-1],this.$[0]==="rule"&&!this.$[2]&&(this.$[2]=["premise",null],this.$[2].auto=!0);break;case 8:this.$=["with",l[h]];break;case 10:this.$=["error",V];break;case 11:this.$=["exists",l[h-2],l[h]];break;case 12:this.$=["forall",l[h-2],l[h]];break;case 13:this.$=["<->",l[h-2],l[h]];break;case 14:this.$=["->",l[h-2],l[h]];break;case 15:case 17:case 19:case 21:case 24:this.$=l[h];break;case 16:this.$=["or",l[h-2],l[h]];break;case 18:this.$=["and",l[h-2],l[h]];break;case 20:this.$=["not",l[h]];break;case 22:this.$=["=",l[h-2],l[h]];break;case 23:this.$=["bot"];break;case 25:this.$=l[h-1],this.$.userParens=!0;break;case 27:this.$=l[h],this.$.unshift(l[h-2]);break;case 29:this.$=["id",l[h-3],l[h-1]];break;case 30:this.$=["id",l[h]];break}},table:[e([6,8],t,{3:1,4:2,7:3,14:5,18:6,22:10,25:11,27:12,30:14,31:15,2:i,9:n,17:r,19:s,21:o,29:a,33:u,34:c}),{1:[3]},{5:19,6:[2,31],8:[1,20]},e(m,[2,2]),e(_,t,{7:3,14:5,18:6,22:10,25:11,27:12,30:14,31:15,10:21,4:22,2:i,9:n,16:[1,23],17:r,19:s,21:o,29:a,33:u,34:c}),e(m,[2,37],{15:24,38:[1,25]}),e(b,[2,9]),e(b,[2,10]),{17:[1,26]},{17:[1,27]},e(b,[2,15],{23:[1,28],24:[1,29]}),e(S,[2,17],{26:[1,30]}),e(j,[2,19],{28:[1,31]}),{17:r,27:32,29:a,30:14,31:15,33:u,34:c},e(I,[2,21]),e(I,[2,24],{32:[1,33]}),e(I,[2,23]),{2:i,14:34,17:r,18:6,19:s,21:o,22:10,25:11,27:12,29:a,30:14,31:15,33:u,34:c},e(Y,[2,30],{34:[1,35]}),{6:[1,36]},{2:i,6:[2,32],7:37,9:n,14:5,17:r,18:6,19:s,21:o,22:10,25:11,27:12,29:a,30:14,31:15,33:u,34:c},{8:[1,38]},{8:[1,40],12:[2,35],13:39},{17:[1,41]},e(m,[2,7]),e(m,[2,38]),{20:[1,42]},{20:[1,43]},{17:r,18:44,19:s,21:o,22:10,25:11,27:12,29:a,30:14,31:15,33:u,34:c},{17:r,18:45,19:s,21:o,22:10,25:11,27:12,29:a,30:14,31:15,33:u,34:c},{17:r,22:46,25:11,27:12,29:a,30:14,31:15,33:u,34:c},{17:r,25:47,27:12,29:a,30:14,31:15,33:u,34:c},e(I,[2,20]),{17:r,31:48},{35:[1,49]},{17:r,31:51,35:L,36:50},{1:[2,1]},e(m,[2,3]),e(_,t,{7:3,14:5,18:6,22:10,25:11,27:12,30:14,31:15,4:52,2:i,9:n,17:r,19:s,21:o,29:a,33:u,34:c}),{12:[1,53]},{2:i,7:37,9:n,12:[2,36],14:5,17:r,18:6,19:s,21:o,22:10,25:11,27:12,29:a,30:14,31:15,33:u,34:c},{8:[2,8]},{17:r,18:54,19:s,21:o,22:10,25:11,27:12,29:a,30:14,31:15,33:u,34:c},{17:r,18:55,19:s,21:o,22:10,25:11,27:12,29:a,30:14,31:15,33:u,34:c},e(b,[2,13]),e(b,[2,14]),e(S,[2,16]),e(j,[2,18]),e(I,[2,22]),e(I,[2,25]),{35:[1,56]},{35:[2,26],37:[1,57]},{8:[1,59],11:58,12:[2,33]},e(m,[2,6]),e(b,[2,11]),e(b,[2,12]),e(Y,[2,29]),{17:r,31:51,35:L,36:60},{12:[1,61]},{2:i,7:37,9:n,12:[2,34],14:5,17:r,18:6,19:s,21:o,22:10,25:11,27:12,29:a,30:14,31:15,33:u,34:c},{35:[2,27]},e(m,[2,5])],defaultActions:{36:[2,1],41:[2,8],60:[2,27]},parseError:function(V,f){if(f.recoverable)this.trace(V);else{var p=new Error(V);throw p.hash=f,p}},parse:function(V){var f=this,p=[0],g=[],x=[null],l=[],A=this.table,h="",G=0,K=0,X=0,R=2,Q=1,H=l.slice.call(arguments,1),k=Object.create(this.lexer),U={yy:{}};for(var $ in this.yy)Object.prototype.hasOwnProperty.call(this.yy,$)&&(U.yy[$]=this.yy[$]);k.setInput(V,U.yy),U.yy.lexer=k,U.yy.parser=this,typeof k.yylloc>"u"&&(k.yylloc={});var J=k.yylloc;l.push(J);var M=k.options&&k.options.ranges;typeof U.yy.parseError=="function"?this.parseError=U.yy.parseError:this.parseError=Object.getPrototypeOf(this).parseError;function Ne(C){p.length=p.length-2*C,x.length=x.length-C,l.length=l.length-C}function xe(){var C;return C=g.pop()||k.lex()||Q,typeof C!="number"&&(C instanceof Array&&(g=C,C=g.pop()),C=f.symbols_[C]||C),C}for(var O,te,D,N,sr,Le,re={},ye,W,Ye,ve;;){if(D=p[p.length-1],this.defaultActions[D]?N=this.defaultActions[D]:((O===null||typeof O>"u")&&(O=xe()),N=A[D]&&A[D][O]),typeof N>"u"||!N.length||!N[0]){let C=function(Me){for(var De=p.length-1,Ge=0;;){if(R.toString()in A[Me])return Ge;if(Me===0||De<2)return!1;De-=2,Me=p[De],++Ge}};var or=C,le,ue="";if(X)te!==Q&&(le=C(D));else{le=C(D),ve=[];for(ye in A[D])this.terminals_[ye]&&ye>R&&ve.push("'"+this.terminals_[ye]+"'");k.showPosition?ue="Parse error on line "+(G+1)+`:
`+k.showPosition()+`
Expecting `+ve.join(", ")+", got '"+(this.terminals_[O]||O)+"'":ue="Parse error on line "+(G+1)+": Unexpected "+(O==Q?"end of input":"'"+(this.terminals_[O]||O)+"'"),this.parseError(ue,{text:k.match,token:this.terminals_[O]||O,line:k.yylineno,loc:J,expected:ve,recoverable:le!==!1})}if(X==3){if(O===Q||te===Q)throw new Error(ue||"Parsing halted while starting to recover from another error.");K=k.yyleng,h=k.yytext,G=k.yylineno,J=k.yylloc,O=xe()}if(le===!1)throw new Error(ue||"Parsing halted. No suitable error recovery rule available.");Ne(le),te=O==R?null:O,O=R,D=p[p.length-1],N=A[D]&&A[D][R],X=3}if(N[0]instanceof Array&&N.length>1)throw new Error("Parse Error: multiple actions possible at state: "+D+", token: "+O);switch(N[0]){case 1:p.push(O),x.push(k.yytext),l.push(k.yylloc),p.push(N[1]),O=null,te?(O=te,te=null):(K=k.yyleng,h=k.yytext,G=k.yylineno,J=k.yylloc,X>0&&X--);break;case 2:if(W=this.productions_[N[1]][1],re.$=x[x.length-W],re._$={first_line:l[l.length-(W||1)].first_line,last_line:l[l.length-1].last_line,first_column:l[l.length-(W||1)].first_column,last_column:l[l.length-1].last_column},M&&(re._$.range=[l[l.length-(W||1)].range[0],l[l.length-1].range[1]]),Le=this.performAction.apply(re,[h,K,G,U.yy,N[1],x,l].concat(H)),typeof Le<"u")return Le;W&&(p=p.slice(0,-1*W*2),x=x.slice(0,-1*W),l=l.slice(0,-1*W)),p.push(this.productions_[N[1]][0]),x.push(re.$),l.push(re._$),Ye=A[p[p.length-2]][p[p.length-1]],p.push(Ye);break;case 3:return!0}}return!0}},Re=function(){var z={EOF:1,parseError:function(p,g){if(this.yy.parser)this.yy.parser.parseError(p,g);else throw new Error(p)},setInput:function(f,p){return this.yy=p||this.yy||{},this._input=f,this._more=this._backtrack=this.done=!1,this.yylineno=this.yyleng=0,this.yytext=this.matched=this.match="",this.conditionStack=["INITIAL"],this.yylloc={first_line:1,first_column:0,last_line:1,last_column:0},this.options.ranges&&(this.yylloc.range=[0,0]),this.offset=0,this},input:function(){var f=this._input[0];this.yytext+=f,this.yyleng++,this.offset++,this.match+=f,this.matched+=f;var p=f.match(/(?:\r\n?|\n).*/g);return p?(this.yylineno++,this.yylloc.last_line++):this.yylloc.last_column++,this.options.ranges&&this.yylloc.range[1]++,this._input=this._input.slice(1),f},unput:function(f){var p=f.length,g=f.split(/(?:\r\n?|\n)/g);this._input=f+this._input,this.yytext=this.yytext.substr(0,this.yytext.length-p),this.offset-=p;var x=this.match.split(/(?:\r\n?|\n)/g);this.match=this.match.substr(0,this.match.length-1),this.matched=this.matched.substr(0,this.matched.length-1),g.length-1&&(this.yylineno-=g.length-1);var l=this.yylloc.range;return this.yylloc={first_line:this.yylloc.first_line,last_line:this.yylineno+1,first_column:this.yylloc.first_column,last_column:g?(g.length===x.length?this.yylloc.first_column:0)+x[x.length-g.length].length-g[0].length:this.yylloc.first_column-p},this.options.ranges&&(this.yylloc.range=[l[0],l[0]+this.yyleng-p]),this.yyleng=this.yytext.length,this},more:function(){return this._more=!0,this},reject:function(){if(this.options.backtrack_lexer)this._backtrack=!0;else return this.parseError("Lexical error on line "+(this.yylineno+1)+`. You can only invoke reject() in the lexer when the lexer is of the backtracking persuasion (options.backtrack_lexer = true).
`+this.showPosition(),{text:"",token:null,line:this.yylineno});return this},less:function(f){this.unput(this.match.slice(f))},pastInput:function(){var f=this.matched.substr(0,this.matched.length-this.match.length);return(f.length>20?"...":"")+f.substr(-20).replace(/\n/g,"")},upcomingInput:function(){var f=this.match;return f.length<20&&(f+=this._input.substr(0,20-f.length)),(f.substr(0,20)+(f.length>20?"...":"")).replace(/\n/g,"")},showPosition:function(){var f=this.pastInput(),p=new Array(f.length+1).join("-");return f+this.upcomingInput()+`
`+p+"^"},test_match:function(f,p){var g,x,l;if(this.options.backtrack_lexer&&(l={yylineno:this.yylineno,yylloc:{first_line:this.yylloc.first_line,last_line:this.last_line,first_column:this.yylloc.first_column,last_column:this.yylloc.last_column},yytext:this.yytext,match:this.match,matches:this.matches,matched:this.matched,yyleng:this.yyleng,offset:this.offset,_more:this._more,_input:this._input,yy:this.yy,conditionStack:this.conditionStack.slice(0),done:this.done},this.options.ranges&&(l.yylloc.range=this.yylloc.range.slice(0))),x=f[0].match(/(?:\r\n?|\n).*/g),x&&(this.yylineno+=x.length),this.yylloc={first_line:this.yylloc.last_line,last_line:this.yylineno+1,first_column:this.yylloc.last_column,last_column:x?x[x.length-1].length-x[x.length-1].match(/\r?\n?/)[0].length:this.yylloc.last_column+f[0].length},this.yytext+=f[0],this.match+=f[0],this.matches=f,this.yyleng=this.yytext.length,this.options.ranges&&(this.yylloc.range=[this.offset,this.offset+=this.yyleng]),this._more=!1,this._backtrack=!1,this._input=this._input.slice(f[0].length),this.matched+=f[0],g=this.performAction.call(this,this.yy,this,p,this.conditionStack[this.conditionStack.length-1]),this.done&&this._input&&(this.done=!1),g)return g;if(this._backtrack){for(var A in l)this[A]=l[A];return!1}return!1},next:function(){if(this.done)return this.EOF;this._input||(this.done=!0);var f,p,g,x;this._more||(this.yytext="",this.match="");for(var l=this._currentRules(),A=0;A<l.length;A++)if(g=this._input.match(this.rules[l[A]]),g&&(!p||g[0].length>p[0].length)){if(p=g,x=A,this.options.backtrack_lexer){if(f=this.test_match(g,l[A]),f!==!1)return f;if(this._backtrack){p=!1;continue}else return!1}else if(!this.options.flex)break}return p?(f=this.test_match(p,l[x]),f!==!1?f:!1):this._input===""?this.EOF:this.parseError("Lexical error on line "+(this.yylineno+1)+`. Unrecognized text.
`+this.showPosition(),{text:"",token:null,line:this.yylineno})},lex:function(){var p=this.next();return p||this.lex()},begin:function(p){this.conditionStack.push(p)},popState:function(){var p=this.conditionStack.length-1;return p>0?this.conditionStack.pop():this.conditionStack[0]},_currentRules:function(){return this.conditionStack.length&&this.conditionStack[this.conditionStack.length-1]?this.conditions[this.conditionStack[this.conditionStack.length-1]].rules:this.conditions.INITIAL.rules},topState:function(p){return p=this.conditionStack.length-1-Math.abs(p||0),p>=0?this.conditionStack[p]:"INITIAL"},pushState:function(p){this.begin(p)},stateStackSize:function(){return this.conditionStack.length},options:{},performAction:function(p,g,x,l){var A=l;switch(x){case 0:break;case 1:return 28;case 2:return 26;case 3:return 24;case 4:return 23;case 5:return 29;case 6:return 32;case 7:return 16;case 8:break;case 9:g.yytext=g.yytext.substr(g.yytext.substr(1).search(/\S/)),g.yytext=g.yytext.match(/^[^\#]*/)[0],g.yytext=g.yytext.trim();var h=g.yytext.search(/\s+\d+/),G=null;h!=-1&&(G=g.yytext.substr(h+1).split(/\s*,\s*/),g.yytext=g.yytext.substr(0,h));var K=g.yytext.split(".",2),X=null,R=null;if(K.length==2){X=K[0].trim();var R=K[1].split(";").map(xe=>xe.trim()),Q=R[R.length-1].split(" ",2);R[R.length-1]=Q[0],Q.length>=2?g.yytext=Q[1]:g.yytext=""}else{var H=g.yytext.split(" ",2);X=H[0],H.length>=2?g.yytext=H[1]:g.yytext=""}var H=g.yytext.match(/([a-zA-Z]+)(\d+)?/),k=null,U=null;H&&(k=H[1],H.length>=3&&(U=H[2]));var $=null;if(R){$=Array(0);for(let Ne of R)$.push(Ne.split("/"))}return g.yytext=[X,k,U,G,$],38;break;case 10:return 19;case 11:return 21;case 12:return 34;case 13:return 35;case 14:return 33;case 15:return 17;case 16:return 37;case 17:return 20;case 18:for(var M=[];this._iemitstack[0];)M.unshift("DEBOX"),this._iemitstack.shift();if(M.unshift("ENDOFFILE"),M.length)return M;break;case 19:return this._log("MANUAL DEBOX"),this._iemitstack.shift(),["DEBOX","EOL"];break;case 20:break;case 21:var J=(g.yytext.match(/\|/g)||[]).length;if(J>this._iemitstack[0])return this._iemitstack.unshift(J),this._log(this.topState(),"BOX",this.stateStackSize()),this.myBegin(this.topState(),"deepening, due to indent"),["BOX","EOL"];for(var M=["EOL"];J<this._iemitstack[0];)this.myPopState(),this._log(this.topState(),"DEBOX",this.stateStackSize()),M.push("DEBOX"),this._iemitstack.shift();return M[M.length-1]==="DEBOX"&&M.push("EOL"),M;break;case 22:return 8;case 23:break;case 24:return 2}},rules:[/^(?:[\n\r]?#.*)/,/^(?:and|∧|&)/,/^(?:or|∨|v|\+)/,/^(?:implies|->|→)/,/^(?:iff|<->)/,/^(?:not|~|¬)/,/^(?:=)/,/^(?:with\b)/,/^(?:\d+)/,/^(?:(:.*))/,/^(?:E|∃)/,/^(?:A|∀)/,/^(?:\()/,/^(?:\))/,/^(?:_\|_|⊥|bot\b)/,/^(?:([a-zA-Z_][a-zA-Z_'"0-9\|]*))/,/^(?:,)/,/^(?:\.)/,/^(?:[\n\r]*$)/,/^(?:\n([\t \u00a0\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200a\u200b\u2028\u2029\u3000])*\|*-+)/,/^(?:[\n\r]+([\t \u00a0\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200a\u200b\u2028\u2029\u3000])*(?![^\n\r]))/,/^(?:[\n|^]([\t \u00a0\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200a\u200b\u2028\u2029\u3000])*\d*([\t \u00a0\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200a\u200b\u2028\u2029\u3000])*\|*)/,/^(?:\n)/,/^(?:([\t \u00a0\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200a\u200b\u2028\u2029\u3000])+)/,/^(?:.*)/],conditions:{INITIAL:{rules:[0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24],inclusive:!0}}};let V=z.setInput;return z.setInput=function(f){let p=!1;return this._iemitstack=[0],this._log=function(){p&&console.log.apply(this,arguments)},this.myBegin=function(g,x){this._log("Begin "+g+" because "+x),this.begin(g)},this.myPopState=function(){this._log("Popping "+this.popState()+" to "+this.topState())},V.call(this,f)},z}();ee.lexer=Re;function ae(){this.yy={}}return ae.prototype=ee,ee.Parser=ae,new ae}();typeof be<"u"&&typeof Z<"u"&&(Z.parser=Ee,Z.Parser=Ee.Parser,Z.parse=function(){return Ee.parse.apply(Ee,arguments)},Z.main=function(t){t[1]||(console.log("Usage: "+t[0]+" FILE"),process.exit(1));var i=be("fs").readFileSync($e().normalize(t[1]),"utf8");return Z.parser.parse(i)},typeof Te<"u"&&be.main===Te&&Z.main(process.argv.slice(1)))});var We=Ke(je(),1);var et=(e=0)=>t=>`\x1B[${t+e}m`,tt=(e=0)=>t=>`\x1B[${38+e};5;${t}m`,rt=(e=0)=>(t,i,n)=>`\x1B[${38+e};2;${t};${i};${n}m`,w={modifier:{reset:[0,0],bold:[1,22],dim:[2,22],italic:[3,23],underline:[4,24],overline:[53,55],inverse:[7,27],hidden:[8,28],strikethrough:[9,29]},color:{black:[30,39],red:[31,39],green:[32,39],yellow:[33,39],blue:[34,39],magenta:[35,39],cyan:[36,39],white:[37,39],blackBright:[90,39],gray:[90,39],grey:[90,39],redBright:[91,39],greenBright:[92,39],yellowBright:[93,39],blueBright:[94,39],magentaBright:[95,39],cyanBright:[96,39],whiteBright:[97,39]},bgColor:{bgBlack:[40,49],bgRed:[41,49],bgGreen:[42,49],bgYellow:[43,49],bgBlue:[44,49],bgMagenta:[45,49],bgCyan:[46,49],bgWhite:[47,49],bgBlackBright:[100,49],bgGray:[100,49],bgGrey:[100,49],bgRedBright:[101,49],bgGreenBright:[102,49],bgYellowBright:[103,49],bgBlueBright:[104,49],bgMagentaBright:[105,49],bgCyanBright:[106,49],bgWhiteBright:[107,49]}},cr=Object.keys(w.modifier),Lt=Object.keys(w.color),Mt=Object.keys(w.bgColor),pr=[...Lt,...Mt];function Dt(){let e=new Map;for(let[t,i]of Object.entries(w)){for(let[n,r]of Object.entries(i))w[n]={open:`\x1B[${r[0]}m`,close:`\x1B[${r[1]}m`},i[n]=w[n],e.set(r[0],r[1]);Object.defineProperty(w,t,{value:i,enumerable:!1})}return Object.defineProperty(w,"codes",{value:e,enumerable:!1}),w.color.close="\x1B[39m",w.bgColor.close="\x1B[49m",w.color.ansi=et(),w.color.ansi256=tt(),w.color.ansi16m=rt(),w.bgColor.ansi=et(10),w.bgColor.ansi256=tt(10),w.bgColor.ansi16m=rt(10),Object.defineProperties(w,{rgbToAnsi256:{value(t,i,n){return t===i&&i===n?t<8?16:t>248?231:Math.round((t-8)/247*24)+232:16+36*Math.round(t/255*5)+6*Math.round(i/255*5)+Math.round(n/255*5)},enumerable:!1},hexToRgb:{value(t){let i=/[a-f\d]{6}|[a-f\d]{3}/i.exec(t.toString(16));if(!i)return[0,0,0];let[n]=i;n.length===3&&(n=[...n].map(s=>s+s).join(""));let r=Number.parseInt(n,16);return[r>>16&255,r>>8&255,r&255]},enumerable:!1},hexToAnsi256:{value:t=>w.rgbToAnsi256(...w.hexToRgb(t)),enumerable:!1},ansi256ToAnsi:{value(t){if(t<8)return 30+t;if(t<16)return 90+(t-8);let i,n,r;if(t>=232)i=((t-232)*10+8)/255,n=i,r=i;else{t-=16;let a=t%36;i=Math.floor(t/36)/5,n=Math.floor(a/6)/5,r=a%6/5}let s=Math.max(i,n,r)*2;if(s===0)return 30;let o=30+(Math.round(r)<<2|Math.round(n)<<1|Math.round(i));return s===2&&(o+=60),o},enumerable:!1},rgbToAnsi:{value:(t,i,n)=>w.ansi256ToAnsi(w.rgbToAnsi256(t,i,n)),enumerable:!1},hexToAnsi:{value:t=>w.ansi256ToAnsi(w.hexToAnsi256(t)),enumerable:!1}}),w}var Tt=Dt(),F=Tt;var Se=(()=>{if(navigator.userAgentData){let e=navigator.userAgentData.brands.find(({brand:t})=>t==="Chromium");if(e&&e.version>93)return 3}return/\b(Chrome|Chromium)\//.test(navigator.userAgent)?1:0})(),nt=Se!==0&&{level:Se,hasBasic:!0,has256:Se>=2,has16m:Se>=3},jt={stdout:nt,stderr:nt},it=jt;function st(e,t,i){let n=e.indexOf(t);if(n===-1)return e;let r=t.length,s=0,o="";do o+=e.slice(s,n)+t+i,s=n+r,n=e.indexOf(t,s);while(n!==-1);return o+=e.slice(s),o}function ot(e,t,i,n){let r=0,s="";do{let o=e[n-1]==="\r";s+=e.slice(r,o?n-1:n)+t+(o?`\r
`:`
`)+i,r=n+1,n=e.indexOf(`
`,r)}while(n!==-1);return s+=e.slice(r),s}var{stdout:at,stderr:lt}=it,Fe=Symbol("GENERATOR"),ie=Symbol("STYLER"),ce=Symbol("IS_EMPTY"),ut=["ansi","ansi","ansi256","ansi16m"],se=Object.create(null),Ft=(e,t={})=>{if(t.level&&!(Number.isInteger(t.level)&&t.level>=0&&t.level<=3))throw new Error("The `level` option should be an integer from 0 to 3");let i=at?at.level:0;e.level=t.level===void 0?i:t.level};var zt=e=>{let t=(...i)=>i.join(" ");return Ft(t,e),Object.setPrototypeOf(t,pe.prototype),t};function pe(e){return zt(e)}Object.setPrototypeOf(pe.prototype,Function.prototype);for(let[e,t]of Object.entries(F))se[e]={get(){let i=ke(this,Ve(t.open,t.close,this[ie]),this[ce]);return Object.defineProperty(this,e,{value:i}),i}};se.visible={get(){let e=ke(this,this[ie],!0);return Object.defineProperty(this,"visible",{value:e}),e}};var ze=(e,t,i,...n)=>e==="rgb"?t==="ansi16m"?F[i].ansi16m(...n):t==="ansi256"?F[i].ansi256(F.rgbToAnsi256(...n)):F[i].ansi(F.rgbToAnsi(...n)):e==="hex"?ze("rgb",t,i,...F.hexToRgb(...n)):F[i][e](...n),Vt=["rgb","hex","ansi256"];for(let e of Vt){se[e]={get(){let{level:i}=this;return function(...n){let r=Ve(ze(e,ut[i],"color",...n),F.color.close,this[ie]);return ke(this,r,this[ce])}}};let t="bg"+e[0].toUpperCase()+e.slice(1);se[t]={get(){let{level:i}=this;return function(...n){let r=Ve(ze(e,ut[i],"bgColor",...n),F.bgColor.close,this[ie]);return ke(this,r,this[ce])}}}}var Ht=Object.defineProperties(()=>{},{...se,level:{enumerable:!0,get(){return this[Fe].level},set(e){this[Fe].level=e}}}),Ve=(e,t,i)=>{let n,r;return i===void 0?(n=e,r=t):(n=i.openAll+e,r=t+i.closeAll),{open:e,close:t,openAll:n,closeAll:r,parent:i}},ke=(e,t,i)=>{let n=(...r)=>Ut(n,r.length===1?""+r[0]:r.join(" "));return Object.setPrototypeOf(n,Ht),n[Fe]=e,n[ie]=t,n[ce]=i,n},Ut=(e,t)=>{if(e.level<=0||!t)return e[ce]?"":t;let i=e[ie];if(i===void 0)return t;let{openAll:n,closeAll:r}=i;if(t.includes("\x1B"))for(;i!==void 0;)t=st(t,i.close,i.open),i=i.parent;let s=t.indexOf(`
`);return s!==-1&&(t=ot(t,r,n,s)),n+t+r};Object.defineProperties(pe.prototype,se);var Xt=pe(),yr=pe({level:lt?lt.level:0});var fe=Xt;var Qt=!1;function ct(){return Qt}var Er=fe.green,Sr=fe.red,kr=fe.hex("#FFA500"),pt=fe.blue,He=["forall","exists"],we=["not"],_e=["<->","->","and","or","="],ft={not:4,"=":4,forall:1,exists:1,and:3,or:3,"->":2,"<->":2},Ie={not:"~","=":"=",forall:"A",exists:"E",and:"&",or:"v","->":"->","<->":"<->"},ht={parentheses:"user"};function E(){ct()&&console.log(pt(...Array.prototype.slice.call(arguments)))}var P=function(t){this.getName=function(){return t.name},this.getType=function(){return t.type},this.getSimpleVerifier=function(){return t.verifier||null},this.getIntroVerifier=function(){return t.introduction||null},this.getElimVerifier=function(){return t.elimination||null}};var gt=Ke(je(),1),y=function(t,i){var n=this;this.exec=function(r,s,o,a,u){E("Justifier",s,o,a,u);var c=n.checkParams(s,o,a,u);return typeof c=="string"?c:(E("Calling justifier on checked",c),i(r,s,c[0],c[1],c[2]))},this.checkParams=function(s,o,a,u){if(t===null)return o!=null?"Step part (e.g., 2 in 'and e2') not applicable, in this context.":a!=null?"Step references not applicable.":u!=null?"Substitutions not applicable.":[];var c=null,m=[],_=null;if(t.hasPart){if(c=parseInt(o),!(c==1||c==2))return"Part number must be 1 or 2"}else if(o!=null)return"Step part (e.g., 2 in 'and e2') not applicable, in this context.";if(t.stepRefs){var b;if(t.stepRefs.length>0&t.stepRefs[t.stepRefs.length-1]=="nums"){b=t.stepRefs.slice(0,-1);var S=a.length-b.length;S>0&&(b=b.concat(Array(S).fill("num")))}else b=t.stepRefs;if(a.length!=b.length){var j=b.map(function(Re){return Re=="num"?"n":"n-m"});return"Step reference mismatch; required format: "+j.join(", ")+"."}for(var I=0;I<a.length;I++)if(b[I]=="num"){var Y=parseInt(a[I])-1;if(!(Y>=0&&Y<s))return"Step reference #"+(I+1)+" must be 1 <= step < current.";m.push(Y)}else{var L=a[I].split("-");if(L.length!=2||(L=[parseInt(L[0])-1,parseInt(L[1])-1],L[0]>L[1]||Math.max(L[0],L[1])>=s))return"Step reference # "+(I+1)+" must be range, a-b, with a <= b.";m.push(L)}}else if(a!=null)return"Step references not applicable, here.";if(t.subst){if(!u)return"Substitution specification required (e.g., A.x/x0 intro n-m)";var _=u.map(Wt),ee=_.find(ae=>typeof ae=="string");if(ee)return ee;E("subst",u,"parsedSubst",_)}else if(u)return"Substitution unexpected.";return[c,m,_]}},Wt=function(e){if(e.length!=2)return"Substitution must consist of a variable and a term (e.g., x/f(c))";var t="^[A-Za-z_][A-Za-z_0-9]*$",i=e[0].match(t);if(!i)return"Substitution must substitute for a variable, but got "+e[0]+".";var n=gt.default.parser.parse(e[1]);if(typeof n=="string")return n;var r=n[0][1];return r[0]=="id"?[i[0],r]:"Substitution does not have a valid term, should be of the form x/f(c), but got "+e[1]+"."};function T(e,t,i){for(E("substitute",e,t),i=i||[];e[0]==="paren";)e=e[1];if(_e.includes(e[0])){let n=T(e[1],t),r=T(e[2],t);return[e[0],n,r]}else{if(we.includes(e[0])||He.includes(e[0]))return e[0]==="forall"||e[0]==="exists"?(i=i.slice(0),i.push(e[1]),[e[0],e[1],T(e[2],t,i)]):[e[0],T(e[1],t,i)];if(e[0]==="id"){if(e.length===2){if(!i.includes(e[1])){let n=t.find(r=>r[0]===e[1]);if(n)return n[1]}return e}if(e.length===3){let n=[];for(let r=0;r<e[2].length;r++)n.push(T(e[2][r],t,i));return[e[0],e[1],n]}throw Error("Unexpected AST format.")}else return e}}function d(e,t,i,n){E("Expr.equal",e,t);let r;if(i)return r=!0,s(e,t,{});return r=!1,s(e,t);function s(o,a,u){if(r&&d(o,i)&&(o[0]!=="id"||!u[o[1]])&&s(n,a,u))return!0;if(_e.includes(o[0])&&o[0]===a[0])return s(o[1],a[1],u)&&s(o[2],a[2],u);if(we.includes(o[0])&&o[0]===a[0])return s(o[1],a[1],u);if(o[0]==="exists"||o[0]==="forall"&&o[0]===a[0]){let c;return r&&(c=structuredClone(u),c[o[1]]=!0),s(o[2],a[2],c)}else{if(o[0]==="bot")return a[0]==="bot";if(o[0]==="id"){if(a&&o[1]!==a[1])return!1;if(o.length===2&&a.length===2)return!0;if(o.length===3&&a.length===3){if(o[2].length!==a[2].length)return!1;for(let c=0;c<o[2].length;c++)if(!s(o[2][c],a[2][c],u))return!1;return!0}}}return!1}}function Oe(e){return E("isContradiction",e),e[0]==="bot"}function mt(e){return console.assert(Array.isArray(e)&&e.length>0,"Expected expression but got %o",e),He.indexOf(e[0])>=0}function dt(e){return console.assert(Array.isArray(e)&&e.length>0,"Expected expression but got %o",e),we.indexOf(e[0])>=0}function xt(e){return console.assert(Array.isArray(e)&&e.length>0,"Expected expression but got %o",e),_e.indexOf(e[0])>=0}function Yt(e){return console.assert(Array.isArray(e)&&e.length>0,"Expected expression but got %o",e),e[0]==="id"}function Ue(e){return console.assert(Array.isArray(e)&&e.length>0,"Expected expression but got %o",e),e[0]==="id"||e[0]==="="}function Gt(e,t,i){return t<e?"("+i+")":i}function Jt(e){let t="";for(let i of e)t.length!==0&&(t+=", "),t+=yt(i);return t}function yt(e){E("prettyTerm",e);let t=e[1],i="";return e.length===3&&(i="("+Jt(e[2])+")"),t+i}function he(e,t){if(E("prettyRec",e,t),Yt(t))return yt(t);if(mt(t)||xt(t)||dt(t)){let i=ft[t[0]],n;if(mt(t)){let r=t[1],s=he(i,t[2]);n=Ie[t[0]]+r+"."+s}else if(xt(t)){let r=he(i+1,t[1]),s=he(i,t[2]);n=r+" "+Ie[t[0]]+" "+s}else if(dt(t)){let r=he(i,t[1]);n=Ie[t[0]]+r}return Gt(e,i,n)}else console.assert(!1,`Expr.pretty: Case not covered for ${t}`)}function v(e){return he(0,e)}function ge(e){let t="";for(let i of e)t.length!==0&&(t+=";"),t+=i[0]+"/"+v(i[1]);return t}var vt={premise:new P({name:"Premise",type:"simple",verifier:new y(null,function(e,t){return!0})}),sorry:new P({name:"Sorry",type:"simple",verifier:new y(null,function(e,t){return!0})}),assumption:new P({name:"Assumption",type:"simple",verifier:new y(null,function(e,t){return e.steps[t].isFirstStmt()?!0:"Assumptions can only be made at the start of an assumption box."})}),lem:new P({name:"LEM",type:"derived",verifier:new y(null,function(e,t){var i=e.steps[t].getSentence();if(i[0]!=="or")return"LEM: must be phi or not phi.";var n=i[1],r=i[2];return r[0]!=="not"||!d(n,r[1])?"LEM: right side must be negation of left.":!0})}),copy:new P({name:"COPY",type:"derived",verifier:new y({stepRefs:["num"]},function(e,t,i,n){var r=e.steps[t].getSentence(),s=e.steps[n[0]].getSentence();return d(r,s)?!0:"Copy: Current step is not semantically equal to the referenced step."})}),mt:new P({name:"MT",type:"derived",verifier:new y({stepRefs:["num","num"]},function(e,t,i,n){var r=e.steps[n[0]].getSentence();if(r[0]!=="->")return"MT: 1st referenced step must be implication.";var s=r[1],o=r[2],a=e.steps[n[1]].getSentence();if(a[0]!=="not"||!d(a[1],o))return"MT: 2nd ref step must be negation of right side of 1st ref step.";var u=e.steps[t].getSentence();return u[0]!=="not"||!d(s,u[1])?"MT: current step must be negation of left side of ref step.":!0})}),contra:new P({name:"Contra",type:"derived",verifier:new y({hasPart:!1,stepRefs:["range"],subst:!1},function(e,t,i,n){var r=e.steps[n[0][0]].getSentence(),s=e.steps[n[0][1]].getSentence();if(!Oe(s))return"Contra: Final step in range must be a contradiction.";if(r[0]!=="not")return"Contra: Assumption is not a negation. Might you be thinking of not-introduction?";var o=d(r[1],e.steps[t].getSentence());return o?!0:"Contra: Negation of assumption doesn't match current step."})}),bot:new P({name:"Absurdity",type:"normal",elimination:new y({hasPart:!1,stepRefs:["num"],subst:!1},function(e,t,i,n){var r=e.steps[n[0]].getSentence();return Oe(r)?!0:"Bot-elim: Referenced step is not absurdity, but got "+v(r)+" instead."})}),notnot:new P({name:"Double-negation",type:"normal",elimination:new y({hasPart:!1,stepRefs:["num"],subst:!1},function(e,t,i,n){var r=e.steps[t].getSentence(),s=e.steps[n[0]].getSentence();return s[0]!=="not"||s[1][0]!=="not"?"Notnot-elim: Referenced step is not a double-negation, but got "+v(s)+" instead.":d(s[1][1],r)?!0:"Notnot-elim: Does not result in current step."})}),"->":new P({name:"Implication",type:"normal",introduction:new y({hasPart:!1,stepRefs:["range"],subst:!1},function(e,t,i,n){var r=e.steps[n[0][0]].getSentence(),s=e.steps[n[0][1]].getSentence(),o=e.steps[t].getSentence();if(o[0]!="->")return"Implies-Intro: Current step is not an implication, but got "+v(o)+" instead.";var a=d(o[1],r);if(!a)return"Implies-Intro: The left side does not match the assumption.";var u=d(o[2],s);return u?!0:"Implies-Intro: The result does not match the right side."}),elimination:new y({hasPart:!1,stepRefs:["num","num"],subst:!1},function(e,t,i,n){var r=n[1],s=n[0];if(r>=t||s>=t)return"Implies-Elim: Referenced proof steps must precede current step.";var o=e.steps[r].getSentence(),a=e.steps[s].getSentence();if(a[0]!="->")return"Implies-Elim: Step "+(n[0]+1)+" is not an implication";var u=d(a[1],o),c=d(a[2],e.steps[t].getSentence());return u?c?!0:"Implies-Elim: The left side does not imply this result.":"Implies-Elim: The implication's left side does not match the referenced step."})}),and:new P({name:"And",type:"normal",introduction:new y({stepRefs:["num","num"]},function(e,t,i,n){var r=e.steps[t].getSentence();return r[0]!=="and"?"And-Intro: Current step is not an 'and'-expression."+e.steps[t].getSentence():d(r[1],e.steps[n[0]].getSentence())?d(r[2],e.steps[n[1]].getSentence())?!0:"And-Intro: Right side doesn't match referenced step.":"And-Intro: Left side doesn't match referenced step."}),elimination:new y({hasPart:!0,stepRefs:["num"]},function(e,t,i,n){var r=e.steps[n[0]].getSentence();if(r[0]!="and")return"And-Elim: Referenced step is not an 'and' expression.";var s=d(r[i],e.steps[t].getSentence());return s?!0:"And-Elim: In referenced line, side "+i+" does not match current step."})}),or:new P({name:"Or",type:"normal",introduction:new y({hasPart:!0,stepRefs:["num"]},function(e,t,i,n){var r=e.steps[t].getSentence();return r[0]!=="or"?"Or-Intro: Current step is not an 'or'-expression.":d(r[i],e.steps[n[0]].getSentence())?!0:"Or-Intro: Side "+i+" doesn't match referenced step."}),elimination:new y({stepRefs:["num","range","range"]},function(e,t,i,n){var r=e.steps[t].getSentence(),s=e.steps[n[0]].getSentence(),o=e.steps[n[1][0]].getSentence(),a=e.steps[n[1][1]].getSentence(),u=e.steps[n[2][0]].getSentence(),c=e.steps[n[2][1]].getSentence();return s[0]!=="or"?"Or-Elim: First referenced step is not an 'or'-expression.":d(s[1],o)?d(s[2],u)?d(a,c)?d(a,r)?!0:"Or-Elim: Current step doesn't match step range conclusions.":"Or-Elim: Step range conclusions don't match.":"Or-Elim: Second range range intro doesn't match right side of 'or'.":"Or-Elim: First range intro doesn't match left side of 'or'."})}),neg:new P({name:"Neg",type:"normal",introduction:new y({stepRefs:["range"]},function(e,t,i,n){var r=e.steps[n[0][0]].getSentence(),s=e.steps[n[0][1]].getSentence();if(!Oe(s))return"Neg-Intro: Final step in range must be absurdity.";var o=e.steps[t].getSentence();if(o[0]!=="not")return"Neg-Intro: Current step is not a negation. Might you be thinking of Contra?";var a=d(r,o[1]);return a?!0:"Neg-Intro: Negation of assumption doesn't match current step."}),elimination:new y({stepRefs:["num","num"]},function(e,t,i,n){var r=e.steps[t].getSentence(),s=e.steps[n[0]].getSentence(),o=e.steps[n[1]].getSentence(),a;if(s[0]==="not")a=d(s[1],o);else if(o[0]==="not")a=d(o[1],s);else return"Neg-Elim: Neither referenced proof step is a 'not' expression.";return a?!0:"Neg-Elim: Subexpression in not-expr does not match other expr."})}),"<->":new P({name:"Bi-implication",type:"normal",introduction:new y({stepRefs:["num","num"]},function(e,t,i,n){var r=e.steps[t].getSentence();if(r[0]!=="<->")return"Bi-Implication-Intro: Current step is not an '<->'-expression."+e.steps[t].getSentence();var s=["->"].concat(r.slice(1,3)),o=["->"];return o.push(r[2]),o.push(r[1]),d(s,e.steps[n[0]].getSentence())?d(o,e.steps[n[1]].getSentence())?!0:"Bi-Implication-Intro: Right side doesn't match referenced step: "+v(o)+" != "+v(e.steps[n[1]].getSentence()):"Bi-Implication: Left side doesn't match referenced step: "+v(s)+" != "+v(e.steps[n[0]].getSentence())}),elimination:new y({hasPart:!0,stepRefs:["num"]},function(e,t,i,n){var r=e.steps[n[0]].getSentence();if(r[0]!="<->")return"Bi-Implication-Elim: Referenced step is not an '<->' expression, got "+v(andExp);var s=!1;if(i==1){var o=["->"].concat(r.slice(1,3));s=d(o,e.steps[t].getSentence())}else{var a=["->"];a.push(r[2]),a.push(r[1]),s=d(a,e.steps[t].getSentence())}return s?!0:"Bi-Implication-Elim: In referenced line, side "+i+" does not match current step."})}),a:new P({name:"ForAll",type:"normal",introduction:new y({stepRefs:["range"],subst:!0},function(e,t,i,n,r){var s=e.steps[t],o=s.getSentence(),a=e.steps[n[0][0]],u=a.getSentence(),c=a.getScope(),m=e.steps[n[0][1]].getSentence();if(E("all-intro","startExpr",u,"endExpr",m,"currExpr",o,"scope",c,"subst",r),o[0]!=="forall")return"All-x-Intro: Current step is notf a 'for-all' expression.";if(c.length==0||c[c.length-1]==null)return"All-x-Intro: The provided range does not have a scoping assumption (e.g., an x0 box started by 'with') in step "+(n[0][0]+1)+".";if(r.length>1)return"All-x-intro: Introducing more than one quantifier at the same time is currently not supported";var _=c[c.length-1],b=c.slice().reverse().reduce(function(j,I){return j||I==null||I==r[1]},!0);if(!b)return"All-x-intro: Substitution "+ge(r)+" doesn't match scope: "+c.filter(function(j){if(j!=null)return j}).join(", ");var S=T(o[2],r);return d(m,S)?!0:"All-x-Intro: Last step in range doesn't match current step after "+ge(r)+": "+v(m)+" != "+v(S)+"."}),elimination:new y({stepRefs:["num"],subst:!0},function(e,t,i,n,r){var s=e.steps[t],o=s.getSentence(),a=e.steps[n[0]].getSentence();if(E("all-elim","refExpr",a,"currExpr",o,"subst",r),a[0]!=="forall")return"All-x-Elim: Referenced step is not a for-all expression.";if(r.length>1)return"All-x-elim: Eliminating more than one quantifier at the same time is currently not supported";var u=T(a[2],r);return d(u,o)?!0:"All-x-Elim: Referenced step "+(n[0]+1)+" did not match current step after "+ge(r)+": "+v(u)+" != "+v(o)+"."})}),e:new P({name:"Exists",type:"normal",introduction:new y({stepRefs:["num"],subst:!0},function(e,t,i,n,r){var s=e.steps[t],o=s.getSentence(),a=e.steps[n[0]].getSentence();if(E("ex-intro","refExpr",a,"currExpr",o,"subst",r),o[0]!=="exists")return"Exists-x-Intro: Current step is not an 'exists' expression.";if(r.length>1)return"Exists-x-Intro: Introducing more than one quantifier at the same time is currently not supported";var u=T(o[2],r);return d(a,u)?!0:"Exists-x-Intro: Referenced step "+(n[0]+1)+" did not match current step after "+ge(r)+" substitution: "+v(a)+" != "+v(u)+"."}),elimination:new y({stepRefs:["num","range"],subst:!0},function(e,t,i,n,r){var s=e.steps[t],o=s.getSentence(),a=e.steps[n[0]].getSentence(),u=e.steps[n[1][0]],c=u.getSentence(),m=u.getScope(),_=e.steps[n[1][1]].getSentence();if(a[0]!=="exists")return"Exists-x-Elim: Referenced step is not an 'exists' expression.";if(m.length==0||m[m.length-1]==null)return"Exists-x-Elim: Range must be within an assumption scope (e.g., an x0 box).";if(r.length>1)return"Exists-x-Elim: Eliminating more than one quantifier at the same time is currently not supported";var b=m[m.length-1],S=T(a[2],r);return d(S,c)?d(_,o)?!0:"Exists-x-Elim: assumption ending step "+(n[1][1]+1)+" does not match current step: "+v(_)+" != "+v(o)+".":"Exists-x-Elim: assumption beginning step doesn't match ref step for "+b[0]+"."})}),b:new P({name:"Backchaining",type:"derived",verifier:new y({stepRefs:["num","nums"],subst:!0},function(e,t,i,n,r){var s=e.steps[t],o=s.getSentence(),a=n.map(S=>e.steps[S].getSentence());E("backchaining","steps",n,"refExpr",a,"currExpr",o,"subst",r);var u=bt(a[0]);if(typeof u=="string")return"Backchaining: "+u;var c=u[0],m=u[1];if(m.length!=n.length-1)return"Backchaining: "+(n.length-1)+" proof steps provided, but "+m.length+" required to match the head of the Horn clause "+v(a[0]);var _=m.map(S=>T(S,r)),b=T(u[2],r);if(E("backchaining","headSub",_,"tailSub",b),d(b,o)){for(let S=0;S<_.length;S++)if(!d(_[S],a[S+1]))return"Backchaining: Head formula "+(S+1)+" of Horn clause in step "+(n[0]+1)+" does not match step "+(n[S+1]+1)+": "+v(_[S])+" != "+v(a[S+1])+".";return!0}else return"Backchaining: Tail of Horn clause in step "+(n[0]+1)+" does not match current step: "+v(b)+" != "+v(o)})}),"=":new P({name:"Equality",type:"normal",introduction:new y({},function(e,t,i,n){var r=e.steps[t].getSentence();return r[0]!=="="?"Equality-Intro: Current step is not an equality."+e.steps[t].getSentence():d(r[1],r[2])?!0:"Equality-Intro: Left and right sides do not match."}),elimination:new y({stepRefs:["num","num"]},function(e,t,i,n){var r=e.steps[n[0]].getSentence(),s=e.steps[n[1]].getSentence(),o=e.steps[t].getSentence();return r[0]!=="="?"Equality-Elim: First referenced step is not an equality.":d(s,o,r[1],r[2])?!0:"Equality-Elim: Substituting in step "+(n[1]+1)+" does not result in current step:  formula "+v(s)+" != "+v(o)+" when replacing "+v(r[1])+" by "+v(r[2])})})};function Xe(e){if(Ue(e))return[e];if(e[0]=="and"){var t=Xe(e[1]),i=Xe(e[2]);return t&&i?t.concat(i):null}else return null}function bt(e,t=Array(0)){if(E("openHornClause",e,t),e[0]=="forall")return bt(e[2],t.concat([e[1]]));if(e[0]=="->"){var i=Xe(e[1]);return i?[t,i,e[2]]:"Not a valid head in Horn clause"}else return Ue(e)?[t,[],e]:"Not a valid Horn clause with top-level connective "+e[0]}var Qe=class{constructor(t,i,n,r,s,o){this.isFirst=s,this.isLast=o,this.sentenceAST=t,this.scope=n,this.justificationAST=i,this.loc=r}isFirstStmt(){return this.isFirst}isLastStmt(){return this.isLast}getSentence(){return this.sentenceAST}getScope(){return this.scope}getJustification(){return this.justificationAST}getMeta(){return this.loc}},Pe=class e{static verifyFromAST(t){return e.verify(e.preprocess(t))}static verify(t){let i={message:"Proof is valid.",valid:!0,premiseAllowed:!0,remainingSorries:0};for(let n=0;n<t.steps.length&&(e.validateStatement(i,t,n),!!i.valid);++n);return i}static validateStatement(t,i,n){let r=i.steps[n];if(r[0]==="error"){t.valid=!1,t.message="Proof invalid due to syntax errors.",t.errorStep=n+1;return}let s=r.getJustification();if(E("why",s),s[0]=="premise"){if(!t.premiseAllowed){t.valid=!1,t.message="Introducing premises is only allowed at the start of a proof.",t.errorStep=n+1;return}}else t.premiseAllowed=!1;s[0]=="sorry"&&(t.remainingSorries+=1);let o=e.lookupValidator(s);if(typeof o=="function"){let a=s[2],u=s[3],c=s[4],m=o(i,n,a,u,c);m===!0?t.valid=!0:(t.valid=!1,t.message=m,t.errorStep=n+1,t.errorSrcLoc=r.getMeta());return}else typeof o=="string"&&(t.valid=!1,t.message=o,t.errorStep=n+1,t.errorSrcLoc=r.getMeta());t.valid=!1}static lookupValidator(t){let i=t[0].toLowerCase();i.split(".").length===2&&(i=i.split(".")[0]+".");let n=vt[i];if(!n)return"Cannot find rule: "+i;if(n.getType()==="simple"||n.getType()==="derived"){let r=n.getSimpleVerifier();if(!r)throw new Error("Not implemented for "+i);return r.exec}if(t[1]){let r=t[1].toLowerCase();if("introduction".indexOf(r)===0){let s=n.getIntroVerifier();if(!s)throw new Error("Not implemented for "+i);return s.exec}else if("elimination".indexOf(r)===0){let s=n.getElimVerifier();if(!s)throw new Error("Not implemented for "+i);return s.exec}return"Cannot determine elim/intro rule type from "+r}return"Unrecognized rule: "+t[0]+" "+(t[1]?t[1]:"")+(t[2]?t[2]:"")+" "+(t[3]?t[3]:"")}static preprocess(t){let i={steps:[]};return e.preprocessBox(i,t,0,[]),E("processed proof",i),i}static preprocessBox(t,i,n,r){E("ast",i);for(let s=0;s<i.length;s++)if(i[s][0]==="rule")t.steps[n]=new Qe(i[s][1],i[s][2],r,i[s][3],s==0,s===i.length-1),n=n+1;else if(i[s][0]==="folbox"){let o=r.slice(0);o.push(i[s][2][1]),E("folbox","step",n,"scope",r,"newScope",o),n=e.preprocessBox(t,i[s][1],n,o)}else if(i[s][0]==="box"){let o=r.slice(0);E("box","step",n,"scope",r,"newScope",o),n=e.preprocessBox(t,i[s][1],n,o)}else i[s][0]==="error"&&(t.steps[n]=i[s]);return n}};function St(e,t){let i=Object.assign(ht,t),n=document.createElement("div");return e&&kt(n,e,1,i),n}function kt(e,t,i,n){for(let r=0;r<t.length;r++)E(t[r]),t[r][0]==="rule"?i=Kt(e,t[r],i,n):t[r][0]==="box"?i=Et(e,t[r],i,n,"simple"):t[r][0]==="folbox"?i=Et(e,t[r],i,n,"FOL"):t[r][0]==="error"&&(i=$t(e,t[r],i));return i}function Kt(e,t,i,n){let r=document.createElement("div");r.className="rule";let s=document.createElement("span");return s.className="lineno",s.textContent=i,r.appendChild(s),r.appendChild(me(t[1],n)),r.appendChild(tr(t[2])),e.appendChild(r),i+1}function $t(e,t,i){let n=document.createElement("div");n.className="text-danger font-weight-bold";let r=document.createElement("span");return r.className="lineno",r.textContent=i,n.appendChild(r),n.append("Syntax error: ",t[1]),e.appendChild(n),i+1}function me(e,t){let i;switch(e[0]){case"forall":i="&forall;";break;case"exists":i="&exist;"}if(i){let n=document.createElement("span");n.className="folproof-quantifier",n.insertAdjacentHTML("beforeend",i),n.appendChild(Be(e[1],t)),n.append(". ");let r=me(e[2],t);return n.appendChild(r),Ce(e[0],e[2],!0,t)?(n.append("("),n.appendChild(r),n.append(")")):n.appendChild(r),n}switch(e[0]){case"<->":i="&harr;";break;case"->":i="&rarr;";break;case"and":i="&and;";break;case"or":i="&or;";break;case"=":i="="}if(i){E(e[1],e[2]);let n=me(e[1],t);Ce(e[0],e[1],!0,t)&&(n.prepend("("),n.append(")")),n.append(" "),n.insertAdjacentHTML("beforeend",i),n.append(" ");let r=me(e[2],t);return Ce(e[0],e[2],!1,t)&&(r.prepend("("),r.append(")")),n.appendChild(r),n}if(e[0]==="id")return Be(e,t);if(e[0]==="not"){let n=me(e[1],t);return Ce(e[0],e[1],!0,t)&&(n.prepend("("),n.append(")")),n.insertAdjacentHTML("afterbegin","&not;"),n}return Be(e)}var Ae={not:1,"=":1,forall:2,exists:2,and:3,or:4,"->":5,"<->":6};function Ce(e,t,i,n){return t[0]==="id"?!1:n.parentheses==="user"?t.userParens:n.parentheses==="minimal"?!(Ae[e]==Ae[t[0]]&&i||Ae[e]>Ae[t[0]]&&!i):!0}var er=["="];function Be(e,t){if(e instanceof Array){let i=document.createElement("span");if(e.length===1)return i.appendChild(qe(e[0])),i;if(e.length===2)return i.appendChild(qe(e[1])),i;if(e.length>=3){if(i.className="term parameterized",er.includes(e[1]))i.append(e[2][0][1]," ",e[1]," ",e[2][1][1]);else{i.appendChild(qe(e[1])),i.append("(");for(let n=0;n<e[2].length;n++)i.appendChild(Be(e[2][n],t)),n<e[2].length-1&&i.append(", ");i.append(")")}return i}}else return qe(e)}function qe(e){let t=["alpha","beta","gamma","delta","epsilon","zeta","eta","theta","iota","kappa","lambda","mu","nu","xi","omicron","pi","rho","sigma","tau","upsilon","phi","chi","psi","omega"],i={bot:"&perp;",contradiction:"&perp;"},n=e.match(/(.*?)(\d+)?$/),r=n[1];t.includes(r[0].toLowerCase()+r.substring(1))?r="&"+r+";":i[r]&&(r=i[r]);let s=document.createElement("span");if(s.innerHTML=r,n[2]){s.className="special-symbol";let o=document.createElement("sub");o.textContent=n[2],s.appendChild(o)}else s.className="symbol";return s}function tr(e){let t=document.createElement("div");return t.className="justification",e[0]=="sorry"&&t.classList.add("text-warning"),t.innerText=e[0],e[1]&&t.append(" ",e[1]),e[2]&&t.append(e[2]),e[3]&&t.append(" ",e[3].join(", ")),t}function Et(e,t,i,n,r){let s=document.createElement("div");s.className=r+"-box";let o=kt(s,t[1],i,n);return e.appendChild(s),o}var B=document.getElementById("proof-input"),It=document.getElementById("parentheses"),oe=document.getElementById("result-box"),wt=document.getElementById("result"),_t=document.getElementById("render-panel");function Ot(){let e;try{We.default.trace=(...r)=>{console&&console.log&&console.log(r)},e=We.default.parse(B.value);let i=Pe.verifyFromAST(e),n=i.message;i.valid?oe.className=oe.className.replace(/alert-\w*/,"alert-success"):(n+=`<p>Step: ${i.errorStep}`,i.errorSrcLine&&(n+=`, Src Line: ${i.errorSrcLoc.first_line}`),n+="</p>",oe.className=oe.className.replace(/alert-\w*/,"alert-warning")),n+=`<p>Remaining sorries: ${i.remainingSorries}</p>`,wt.innerHTML=n}catch(i){wt.innerHTML=i,oe.className=oe.className.replace(/alert-\w*/,"alert-light")}let t=St(e,{parentheses:It.value});_t.innerHTML="",_t.appendChild(t)}It.addEventListener("change",Ot);B.addEventListener("input",Ot);var de="9",rr=document.querySelectorAll(".example");rr.forEach(e=>{e.addEventListener("click",nr)});function nr(){de&&document.getElementById(de).classList.remove("active"),this.classList.add("active");let e=this.id;de=e,B.value=Pt.examples[e].join(`
`),B.dispatchEvent(new Event("input"))}B.setAttribute("style","height:"+B.scrollHeight+"px;overflow-y:hidden;");B.addEventListener("input",()=>{B.style.height="auto",B.style.height=B.scrollHeight+"px"});var ir=document.getElementById("clear-input");ir.addEventListener("click",()=>{B.value="",B.dispatchEvent(new Event("input")),document.getElementById(de).classList.remove("active"),de=null});var Pt={examples:{0:["1 \u2200x.P(c, x) : premise","| with x0","2 | P(c,x0) : A.x/x0 e 1","3 | \u2203y.P(y,x0) : E.y/c i 2","4 \u2200x.\u2203y.P(y,x) : A.x/x0 i 2-3"],1:["1 r and u -> w : premise","2 u and ~w : premise","3 | r","4 | u : and e1 2","5 | r and u : and i 3,4","6 | w : -> e 1, 5","7 | ~w : and e2 2","8 | \u22A5 : neg e 6,7","9 ~r : neg i 3-8"],2:["# To use lemmas and previous results, you can include them as extra premises","\xAC(\u2203x.\xACP(x)) \u2192 \u2200x.\xAC\xACP(x) : premise example","\xAC(\u2200x.P(x))","| \xAC(\u2203x.\xACP(x))","| \u2200x.\xAC\xACP(x) : -> e 1,3","|| with x0","|| \xAC\xACP(x0) : A.x/x0 e 4","||| \xACP(x0)","||| \u22A5 : neg e 5,6","||| P(x0) : contra 6-7","| \u2200x.P(x) : A.x/x0 i 5-8","| \u22A5 : neg e 2,9","\u2203x.\xACP(x) : contra 3-10"],3:["\xAC(\u2200x.P(x) \u2192 D(x)) \u2192 (\u2203x. P(x) \u2227 \xACD(x))","\u2203x.P(x)","(\u2200x.P(x) \u2192 D(x)) \u2228 \xAC(\u2200x.P(x) \u2192 D(x)) : lem","| \u2200x.P(x) \u2192 D(x)","|| with x0","|| P(x0)","||| P(x0) \u2227 D(x0)","||| \u2200x.P(x) \u2192 D(x) : copy 4","||| (P(x0) \u2227 D(x0) -> (\u2200x.P(x) \u2192 D(x))) : -> i 6-7","||| (\u2203y. P(y) \u2227 D(y) -> (\u2200x.P(x) \u2192 D(x))) : E.y/x0 i 8","| (\u2203y. P(y) \u2227 D(y) -> (\u2200x.P(x) \u2192 D(x))) : E.x/x0 e 2, 5-9","------","| \xAC(\u2200x.P(x) \u2192 D(x))","| (\u2203x. P(x) \u2227 \xACD(x)) : -> e 1, 11","|| with x0","|| P(x0) \u2227 \xACD(x0)","||| P(x0) \u2227 D(x0)","||| \xACD(x0) : and e2 13","||| D(x0) : and e2 14","||| \u22A5 : neg e 15,16","||| \u2200x.P(x) \u2192 D(x) : bot e 17","||| (P(x0) \u2227 D(x0) -> (\u2200x.P(x) \u2192 D(x))) : -> i 14-18","||| (\u2203y. P(y) \u2227 D(y) -> (\u2200x.P(x) \u2192 D(x))) : E.y/x0 i 19","| (\u2203y. P(y) \u2227 D(y) -> (\u2200x.P(x) \u2192 D(x))) : E.x/x0 e 12, 13-20","------","(\u2203y. P(y) \u2227 D(y) -> (\u2200x.P(x) \u2192 D(x))) : or e 3, 4-10, 11-21"],4:["An. L(n,n)","An.Am. L(n,m) -> L(n, s(m))","L(z,z) : B.n/z 1","L(z,s(z)) : B.n/z;m/z 2,3","Em. L(z, m) : E.m/s(z) i 4"],5:["# We write o for 1, and p(x,y) for x + y.","# We also leave of the quantifier range to not overload the proof, as we do not have definitions available here.","| with x0","|| \u2203y. x0 = p(y,y)","||| with y0","||| x0 = p(y0,y0)","||| p(x0, o) = p(x0, o) : = i","||| p(x0, o) = p(p(y0,y0), o) : = e 2,3","||| \u2203y. p(x0, o) = p(p(y,y), o) : E.y/y0 i 4","|| \u2203y. p(x0, o) = p(p(y,y), o) : E.y/y0 e 1,2-5","| (\u2203y. x0 = p(y,y)) -> \u2203y. p(x0, o) = p(p(y,y), o) : -> i 1-6","\u2200x. (\u2203y. x = p(y,y)) -> (\u2203y. p(x, o) = p(p(y,y), o)) : A.x/x0 i 1-7"],6:["# This is a possible solution to the exam question that asks for a proof of a formula from","# the given formulas, here in lines 1 - 3.","1 (Ex0. Ax1. x0 = i(g(x0), i(x1 , i(x0 , x1)))) & (Ax2. x2 = x2)","2 (Ex3. O(i(i(g(x3), d(x3 , x3 , x3)), x3), x3 , x3) & T(x3)) & (Ax4. x4 = x4)","3 Ex5. (Ax6. x6 = g(g(d(x5 , x6 , x5)))) v x5 = x5","4 Ex0. Ax1. x0 = i(g(x0), i(x1 , i(x0 , x1))) : and e1 1","| with y0","5 | Ax1. y0 = i(g(y0), i(x1 , i(y0 , x1)))","6 | y0 = i(g(y0), i(y0 , i(y0 , y0))) : A.x1/y0 e 5","7 || T(y0)","8 || T(i(g(y0), i(y0 , i(y0 , y0)))) : = e 6,7","9 | T(y0) -> T(i(g(y0), i(y0 , i(y0 , y0)))) : -> i 7-8","10 | Ey. T(y) -> T(i(g(y), i(y , i(y , y)))) : E.y/y0 i 9","11 Ey. T(y) -> T(i(g(y), i(y , i(y , y)))) : E.x0/y0 e 4, 5-10"],7:["# Horn theory exam exercise","# We use the following interpretation:","# d(x, y, z) : assigns to the colour combination of hair, paints and shows a person with that colour combination","# g(x) : maps x to the next colour","# i(p, x) : maps (p,x) to next person after p with pants colour x","# O(p, q, x) : person p sees person q with pants colour x","# T(x) : x is a colour","# Q() : someone has a yellow backpack","# We introduce one extra constant c for the base colour","\u2200p. O(p, p, c)","\u2200p. \u2200q. \u2200x. O(p, q, x) & T(x) -> O(p, i(q, x), g(x))","\u2200x. T(x) -> T(g(x))","T(c)","# ----------------------","O(d(c,c,c), d(c,c,c), c) : B.p/d(c,c,c) 1","O(d(c,c,c), i(d(c,c,c), c), g(c)) : B.p/d(c,c,c); q/d(c,c,c); x/c 2,5,4","T(g(c)) : B.x/c 3,4","O(d(c,c,c), i(i(d(c,c,c), c), g(c)), g(g(c))) : B.p/d(c,c,c); q/i(d(c,c,c), c); x/g(c) 2,6,7","T(g(g(c))) : B.x/g(c) 3,7","O(d(c,c,c), i(i(i(d(c,c,c), c), g(c)), g(g(c))), g(g(g(c)))) : B.p/d(c,c,c); q/i(i(d(c,c,c), c), g(c)); x/g(g(c)) 2,8,9","T(g(g(c))) \u2227 O(d(c,c,c), i(i(i(d(c,c,c), c), g(c)), g(g(c))), g(g(g(c)))) : and i 9,10","\u2203q. T(g(g(c))) \u2227 O(d(c,c,c), q, g(g(g(c)))) : E.q/i(i(i(d(c,c,c),c),g(c)),g(g(c))) i 11","\u2203x. \u2203q. T(x) \u2227 O(d(c,c,c), q, g(x)) : E.x/g(g(c)) i 12","\u2203p. \u2203x. \u2203q. T(x) \u2227 O(p, q, g(x)) : E.p/d(c,c,c) i 13"],8:["# You may use the admissible rules for symmetry and transitivity as follows.","# First turn these rules into Horn clauses like so:","Ax. Ay. x = y -> y = x : premise # (Sym) proven in theorem 9.10","Ax. Ay. Az. x = y & y = z -> x = z : premise # (Trans) proven in theorem 9.10","# Then you can use thes Horn clauses easily with the backchaining rule in proofs:","a = b","b = c","a = c : B.x/a;y/b;z/c 2,3,4"],9:["1 A x.(P(x) -> ~Q(x))","2 | E x.(P(x) and Q(x)) : assumption","  || with x0","3 || P(x0) and Q(x0) : assumption","4 || P(x0) : and elim1 3","5 || P(x0) -> ~Q(x0) : A.x/x0 elim 1","6 || ~Q(x0) : -> e 5,4","7 || Q(x0) : and elim2 3","8 || _|_ : neg elim 6,7","   ---","9 | _|_ : E.x/x0 elim 2,3-8","  ---","10 ~(E x. (P(x) and Q(x))) : neg introduction 2-9"]}};B.value=Pt.examples[9].join(`
`);B.dispatchEvent(new Event("input"));})();
